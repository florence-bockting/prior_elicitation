
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>elicit.elicit &#8212; Prior Learning</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=4acdca81"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/elicit/elicit';</script>
    <link rel="icon" href="../../_static/favicon-light.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/mmp-logo-light.png" class="logo__image only-light" alt="Prior Learning - Home"/>
    <img src="../../_static/mmp-logo-dark.png" class="logo__image only-dark pst-js-only" alt="Prior Learning - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api/modules.html">API</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../api/elicit.html">elicit package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../api/elicit.extras.html">elicit.extras package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../api/elicit.extras.utils.html">elicit.extras.utils module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/elicit.elicit.html">elicit.elicit module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/elicit.initialization.html">elicit.initialization module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/elicit.losses.html">elicit.losses module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/elicit.networks.html">elicit.networks module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/elicit.optimization.html">elicit.optimization module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/elicit.plots.html">elicit.plots module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/elicit.simulations.html">elicit.simulations module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/elicit.targets.html">elicit.targets module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/elicit.utils.html">elicit.utils module</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howto/index.html">How-To</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../explanation/index.html">Explanation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/florence-bockting/prior_elicitation" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for elicit.elicit</h1><div class="highlight"><pre>
<span></span><span class="c1"># noqa SPDX-FileCopyrightText: 2024 Florence Bockting &lt;florence.bockting@tu-dortmund.de&gt;</span>
<span class="c1">#</span>
<span class="c1"># noqa SPDX-License-Identifier: Apache-2.0</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow_probability</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tfp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">elicit</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">el</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">joblib</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span>

<span class="n">tfd</span> <span class="o">=</span> <span class="n">tfp</span><span class="o">.</span><span class="n">distributions</span>


<div class="viewcode-block" id="Dtype">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Dtype">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Dtype</span><span class="p">:</span>
<div class="viewcode-block" id="Dtype.__init__">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Dtype.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vtype</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vtype</span> <span class="o">=</span> <span class="n">vtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span></div>


<div class="viewcode-block" id="Dtype.__call__">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Dtype.__call__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vtype</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
            <span class="n">dtype_dim</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">vtype</span> <span class="o">==</span> <span class="s2">&quot;array&quot;</span><span class="p">:</span>
            <span class="n">dtype_dim</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">dtype_dim</span></div>
</div>



<div class="viewcode-block" id="hyper">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.hyper">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">hyper</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">lower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">),</span>
    <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
    <span class="n">vtype</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
    <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">shared</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specification of prior hyperparameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : string</span>
<span class="sd">        Custom name of hyperparameter.</span>
<span class="sd">    lower : float, optional</span>
<span class="sd">        Lower bound of hyperparameter.</span>
<span class="sd">        The default is unbounded: ``float(&quot;-inf&quot;)``.</span>
<span class="sd">    upper : float, optional</span>
<span class="sd">        Upper bound of hyperparameter.</span>
<span class="sd">        The default is unbounded: ``float(&quot;inf&quot;)``.</span>
<span class="sd">    vtype : string, optional</span>
<span class="sd">        Type of hyperparameter; either &quot;real&quot; or &quot;array&quot;.</span>
<span class="sd">        The default is ``&quot;real&quot;``.</span>
<span class="sd">    dim : integer, optional</span>
<span class="sd">        Dimensionality of variable. Only required if vtype is &quot;array&quot;.</span>
<span class="sd">        The default is ``1``.</span>
<span class="sd">    shared : bool, optional</span>
<span class="sd">        Shared hyperparameter between model parameters.</span>
<span class="sd">        The default is ``False``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    hyppar_dict : dict</span>
<span class="sd">        Dictionary including all hyperparameter settings.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        ``lower``, ``upper`` take only values that are float or &quot;-inf&quot;/&quot;inf&quot;.</span>

<span class="sd">        ``lower`` value should not be higher than ``upper`` value.</span>

<span class="sd">        ``vtype`` value can only be either &#39;real&#39; or &#39;array&#39;.</span>

<span class="sd">        ``dim`` value can&#39;t be &#39;1&#39; if &#39;vtype=&quot;array&quot;&#39;</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # sigma hyperparameter of a parameteric distribution</span>
<span class="sd">    &gt;&gt;&gt; el.hyper(name=&quot;sigma0&quot;, lower=0)</span>

<span class="sd">    &gt;&gt;&gt; # shared hyperparameter</span>
<span class="sd">    &gt;&gt;&gt; el.hyper(name=&quot;sigma&quot;, lower=0, shared=True)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check correct value for lower</span>
    <span class="k">if</span> <span class="n">lower</span> <span class="o">==</span> <span class="s2">&quot;-inf&quot;</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lower</span> <span class="o">!=</span> <span class="s2">&quot;-inf&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;lower must be either &#39;-inf&#39; or a float.&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; Other strings are not allowed.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># check correct value for upper</span>
    <span class="k">if</span> <span class="n">upper</span> <span class="o">==</span> <span class="s2">&quot;inf&quot;</span><span class="p">:</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">upper</span> <span class="o">!=</span> <span class="s2">&quot;inf&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;upper must be either &#39;inf&#39; or a float.&quot;</span> <span class="o">+</span>
            <span class="s2">&quot; Other strings are not allowed.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">lower</span> <span class="o">&gt;</span> <span class="n">upper</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The value for &#39;lower&#39; must be smaller than the value for &#39;upper&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># check values for vtype are implemented</span>
    <span class="k">if</span> <span class="n">vtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;array&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;vtype must be either &#39;real&#39; or &#39;array&#39;. You provided &#39;</span><span class="si">{</span><span class="n">vtype</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># check that dimensionality is adapted when &quot;array&quot; is chosen</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">vtype</span> <span class="o">==</span> <span class="s2">&quot;array&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;For vtype=&#39;array&#39;, the &#39;dim&#39; argument must have a value &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;greater 1.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># constraints</span>
    <span class="c1"># only lower bound</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lower</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">upper</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)):</span>
        <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">LowerBound</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">lower_bound</span><span class="o">.</span><span class="n">inverse</span>
        <span class="n">constraint_name</span> <span class="o">=</span> <span class="s2">&quot;softplusL&quot;</span>
    <span class="c1"># only upper bound</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">upper</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lower</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)):</span>
        <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">UpperBound</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">upper_bound</span><span class="o">.</span><span class="n">inverse</span>
        <span class="n">constraint_name</span> <span class="o">=</span> <span class="s2">&quot;softplusU&quot;</span>
    <span class="c1"># upper and lower bound</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">upper</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lower</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)):</span>
        <span class="n">double_bound</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">DoubleBound</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">double_bound</span><span class="o">.</span><span class="n">inverse</span>
        <span class="n">constraint_name</span> <span class="o">=</span> <span class="s2">&quot;invlogit&quot;</span>
    <span class="c1"># unbounded</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">identity</span>
        <span class="n">constraint_name</span> <span class="o">=</span> <span class="s2">&quot;identity&quot;</span>

    <span class="c1"># value type</span>
    <span class="n">dtype_dim</span> <span class="o">=</span> <span class="n">Dtype</span><span class="p">(</span><span class="n">vtype</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>

    <span class="n">hyppar_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">constraint</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">constraint_name</span><span class="o">=</span><span class="n">constraint_name</span><span class="p">,</span>
        <span class="n">vtype</span><span class="o">=</span><span class="n">dtype_dim</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">shared</span><span class="o">=</span><span class="n">shared</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">hyppar_dict</span></div>



<div class="viewcode-block" id="parameter">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.parameter">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parameter</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">family</span><span class="p">:</span> <span class="nb">callable</span> <span class="ow">or</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hyperparams</span><span class="p">:</span> <span class="nb">callable</span> <span class="ow">or</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">lower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">),</span>
    <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specification of model parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : string</span>
<span class="sd">        Custom name of parameter.</span>
<span class="sd">    family : callable or None</span>
<span class="sd">        Prior distribution family for model parameter.</span>
<span class="sd">        Only required for ``parametric_prior`` method.</span>
<span class="sd">        Must be an `tfp.distributions &lt;https://www.tensorflow.org/probability/api_docs/python/tfp/distributions&gt;`_ object.</span>
<span class="sd">    hyperparams : dict or None</span>
<span class="sd">        Hyperparameters of distribution as specified in **family**.</span>
<span class="sd">        Only required for ``parametric_prior`` method.</span>
<span class="sd">        Structure of dictionary: *keys* must match arguments of</span>
<span class="sd">        `tfp.distributions &lt;https://www.tensorflow.org/probability/api_docs/python/tfp/distributions&gt;`_</span>
<span class="sd">        object and *values* have to be specified using the :func:`hyper`</span>
<span class="sd">        method.</span>
<span class="sd">        Further details are provided in</span>
<span class="sd">        `How-To specify prior hyperparameters (TODO) &lt;url&gt;`_.</span>
<span class="sd">        Default value is ``None``.</span>
<span class="sd">    lower : float, optional</span>
<span class="sd">        Only used if ``method=&quot;deep_prior&quot;``.</span>
<span class="sd">        Lower bound of parameter. If parameter is unbounded ``float(&quot;-inf&quot;)``.</span>
<span class="sd">    upper : float, optional</span>
<span class="sd">        Only used if ``method=&quot;deep_prior&quot;``.</span>
<span class="sd">        Upper bound of parameter.</span>
<span class="sd">        The default is unbounded: ``float(&quot;inf&quot;)``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    param_dict : dict</span>
<span class="sd">        Dictionary including all model (hyper)parameter settings.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        ``family`` has to be a tfp.distributions object.</span>

<span class="sd">        ``hyperparams`` value is a dict with keys corresponding to arguments of</span>
<span class="sd">        tfp.distributions object in &#39;family&#39;. Raises error if key does not</span>
<span class="sd">        correspond to any argument of distribution.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; el.parameter(name=&quot;beta0&quot;,</span>
<span class="sd">    &gt;&gt;&gt;              family=tfd.Normal,</span>
<span class="sd">    &gt;&gt;&gt;              hyperparams=dict(loc=el.hyper(&quot;mu0&quot;),</span>
<span class="sd">    &gt;&gt;&gt;                               scale=el.hyper(&quot;sigma0&quot;, lower=0)</span>
<span class="sd">    &gt;&gt;&gt;                               )</span>
<span class="sd">    &gt;&gt;&gt;              )</span>

<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>

    <span class="c1"># check that family is a tfp.distributions object</span>
    <span class="k">if</span> <span class="n">family</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">family</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">tfd</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;[section: parameters] The argument &#39;family&#39;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;has to be a tfp.distributions object.&quot;</span>
            <span class="p">)</span>

    <span class="c1"># check whether keys of hyperparams dict correspond to arguments of family</span>
    <span class="k">if</span> <span class="n">hyperparams</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">hyperparams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">family</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[section: parameters] &#39;</span><span class="si">{</span><span class="n">family</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; family has no argument &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39;. Check keys of &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;&#39;hyperparams&#39; dict.&quot;</span>
                <span class="p">)</span>

    <span class="c1"># constraints</span>
    <span class="c1"># only lower bound</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lower</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">upper</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)):</span>
        <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">LowerBound</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">lower_bound</span><span class="o">.</span><span class="n">inverse</span>
        <span class="n">constraint_name</span> <span class="o">=</span> <span class="s2">&quot;softplusL&quot;</span>
    <span class="c1"># only upper bound</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">upper</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lower</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)):</span>
        <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">UpperBound</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">upper_bound</span><span class="o">.</span><span class="n">inverse</span>
        <span class="n">constraint_name</span> <span class="o">=</span> <span class="s2">&quot;softplusU&quot;</span>
    <span class="c1"># upper and lower bound</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">upper</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lower</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)):</span>
        <span class="n">double_bound</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">DoubleBound</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">double_bound</span><span class="o">.</span><span class="n">inverse</span>
        <span class="n">constraint_name</span> <span class="o">=</span> <span class="s2">&quot;invlogit&quot;</span>
    <span class="c1"># unbounded</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">identity</span>
        <span class="n">constraint_name</span> <span class="o">=</span> <span class="s2">&quot;identity&quot;</span>

    <span class="n">param_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="n">family</span><span class="p">,</span> <span class="n">hyperparams</span><span class="o">=</span><span class="n">hyperparams</span><span class="p">,</span>
                      <span class="n">constraint_name</span><span class="o">=</span><span class="n">constraint_name</span><span class="p">,</span> <span class="n">constraint</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">param_dict</span></div>



<div class="viewcode-block" id="model">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.model">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">model</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specification of the generative model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : class</span>
<span class="sd">        class that implements the generative model.</span>
<span class="sd">        See `How-To specify the generative_model for details (TODO) &lt;url&gt;`_.</span>
<span class="sd">    **kwargs : keyword arguments, optional</span>
<span class="sd">        additional keyword arguments expected by **obj**.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    generator_dict : dict</span>
<span class="sd">        Dictionary including all generative model settings.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        generative model in ``obj`` requires the input argument</span>
<span class="sd">        &#39;prior_samples&#39;, but argument has not been found.</span>

<span class="sd">        optional argument(s) of the generative model specified in ``obj`` are</span>
<span class="sd">        not specified</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # specify the generative model class</span>
<span class="sd">    &gt;&gt;&gt; class ToyModel:</span>
<span class="sd">    &gt;&gt;&gt;     def __call__(self, prior_samples, design_matrix, **kwargs):</span>
<span class="sd">    &gt;&gt;&gt;         # linear predictor</span>
<span class="sd">    &gt;&gt;&gt;         epred = tf.matmul(prior_samples, design_matrix,</span>
<span class="sd">    &gt;&gt;&gt;                           transpose_b=True)</span>
<span class="sd">    &gt;&gt;&gt;         # data-generating model</span>
<span class="sd">    &gt;&gt;&gt;         likelihood = tfd.Normal(</span>
<span class="sd">    &gt;&gt;&gt;             loc=epred, scale=tf.expand_dims(prior_samples[:, :, -1], -1)</span>
<span class="sd">    &gt;&gt;&gt;             )</span>
<span class="sd">    &gt;&gt;&gt;         # prior predictive distribution</span>
<span class="sd">    &gt;&gt;&gt;         ypred = likelihood.sample()</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt;         return dict(</span>
<span class="sd">    &gt;&gt;&gt;             likelihood=likelihood,</span>
<span class="sd">    &gt;&gt;&gt;             ypred=ypred, epred=epred,</span>
<span class="sd">    &gt;&gt;&gt;             prior_samples=prior_samples</span>
<span class="sd">    &gt;&gt;&gt;             )</span>

<span class="sd">    &gt;&gt;&gt; # specify the model category in the elicit object</span>
<span class="sd">    &gt;&gt;&gt; el.model(obj=ToyModel,</span>
<span class="sd">    &gt;&gt;&gt;          design_matrix=design_matrix</span>
<span class="sd">    &gt;&gt;&gt;          )</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="c1"># get input arguments of generative model class</span>
    <span class="n">input_args</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="fm">__call__</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># check correct input form of generative model class</span>
    <span class="k">if</span> <span class="s2">&quot;prior_samples&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_args</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;[section: model] The generative model class &#39;obj&#39; requires the&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; input variable &#39;prior_samples&#39; but argument has not been found&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; in &#39;obj&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># check that all optional arguments have been provided by the user</span>
    <span class="n">optional_args</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">input_args</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">({</span><span class="s2">&quot;prior_samples&quot;</span><span class="p">,</span> <span class="s2">&quot;self&quot;</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">optional_args</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[section: model] The argument &#39;</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">&#39; required by the&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; generative model class &#39;obj&#39; is missing.&quot;</span>
            <span class="p">)</span>

    <span class="n">generator_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">generator_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">generator_dict</span></div>



<div class="viewcode-block" id="Queries">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Queries">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Queries</span><span class="p">:</span>
<div class="viewcode-block" id="Queries.quantiles">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Queries.quantiles">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">quantiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantiles</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements a quantile-based elicitation technique.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        quantiles : tuple</span>
<span class="sd">            Tuple with respective quantiles ranging between 0 and 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        elicit_dict : dict</span>
<span class="sd">            Dictionary including the quantile settings.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            ``quantiles`` have to be specified as probability ranging between</span>
<span class="sd">            0 and 1.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># compute percentage from probability</span>
        <span class="n">quantiles_perc</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">q</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quantiles</span><span class="p">])</span>

        <span class="c1"># check that quantiles are provided as percentage</span>
        <span class="k">for</span> <span class="n">quantile</span> <span class="ow">in</span> <span class="n">quantiles</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">quantile</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">quantile</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;[section: targets] Quantiles have to be expressed as&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot; probability (between 0 and 1).&quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; Found quantile=</span><span class="si">{</span><span class="n">quantile</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="n">elicit_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;quantiles&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">quantiles_perc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">elicit_dict</span></div>


<div class="viewcode-block" id="Queries.identity">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Queries.identity">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">identity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements an identity function. Should be used if no further</span>
<span class="sd">        transformation of target quantity is required.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        elicit_dict : dict</span>
<span class="sd">            Dictionary including the identity settings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elicit_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">elicit_dict</span></div>


<div class="viewcode-block" id="Queries.correlation">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Queries.correlation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements a method to calculate the pearson correlation between</span>
<span class="sd">        model parameters.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        elicit_dict : dict</span>
<span class="sd">            Dictionary including the correlation settings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elicit_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;pearson_correlation&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">elicit_dict</span></div>


<div class="viewcode-block" id="Queries.custom">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Queries.custom">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">custom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="nb">callable</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements a placeholder for custom target methods. The custom method</span>
<span class="sd">        can be passed as argument.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            Custom target method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        elicit_dict : dict</span>
<span class="sd">            Dictionary including the custom settings.</span>

<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
        <span class="n">elicit_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;custom&quot;</span><span class="p">,</span> <span class="n">func_name</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">func</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">elicit_dict</span></div>
</div>


<span class="c1"># create an instance of the Queries class</span>
<span class="n">queries</span> <span class="o">=</span> <span class="n">Queries</span><span class="p">()</span>


<div class="viewcode-block" id="target">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.target">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">target</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">callable</span> <span class="o">=</span> <span class="n">queries</span><span class="p">,</span>
    <span class="n">loss</span><span class="p">:</span> <span class="nb">callable</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MMD2</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">),</span>
    <span class="n">target_method</span><span class="p">:</span> <span class="nb">callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specification of target quantity and corresponding elicitation technique.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : string</span>
<span class="sd">        Name of the target quantity. Two approaches are possible:</span>
<span class="sd">        (1) Target quantity is identical to an output from the generative</span>
<span class="sd">        model: The name must match the output variable name. (2) Custom target</span>
<span class="sd">        quantity is computed using the **target_method** argument.</span>
<span class="sd">    query : callable</span>
<span class="sd">        Specify the elicitation technique by using one of the methods</span>
<span class="sd">        implemented in :func:`Queries`.</span>
<span class="sd">        See `How-To specify custom elicitation techniques (TODO) &lt;url&gt;`_.</span>
<span class="sd">    loss : callable</span>
<span class="sd">        Loss function for computing the discrepancy between expert data and</span>
<span class="sd">        model simulations. Implemented classes can be found</span>
<span class="sd">        in :mod:`elicit.losses`.</span>
<span class="sd">        The default is the maximum mean discrepancy with</span>
<span class="sd">        an energy kernel: :func:`elicit.losses.MMD2`</span>
<span class="sd">    target_method : callable, optional</span>
<span class="sd">        Custom method for computing a target quantity.</span>
<span class="sd">        Note: This method hasn&#39;t been implemented yet and will raise an</span>
<span class="sd">        ``NotImplementedError``. See for further information the corresponding</span>
<span class="sd">        `GitHub issue #34 &lt;https://github.com/florence-bockting/prior_elicitation/issues/34&gt;`_.</span>
<span class="sd">        The default is ``None``.</span>
<span class="sd">    weight : float, optional</span>
<span class="sd">        Weight of the corresponding elicited quantity in the total loss.</span>
<span class="sd">        The default is ``1.0``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    target_dict : dict</span>
<span class="sd">        Dictionary including all settings regarding the target quantity and</span>
<span class="sd">        corresponding elicitation technique.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; el.target(name=&quot;y_X0&quot;,</span>
<span class="sd">    &gt;&gt;&gt;           query=el.queries.quantiles((.05, .25, .50, .75, .95)),</span>
<span class="sd">    &gt;&gt;&gt;           loss=el.losses.MMD2(kernel=&quot;energy&quot;),</span>
<span class="sd">    &gt;&gt;&gt;           weight=1.0</span>
<span class="sd">    &gt;&gt;&gt;           )</span>

<span class="sd">    &gt;&gt;&gt; el.target(name=&quot;correlation&quot;,</span>
<span class="sd">    &gt;&gt;&gt;           query=el.queries.correlation(),</span>
<span class="sd">    &gt;&gt;&gt;           loss=el.losses.L2,</span>
<span class="sd">    &gt;&gt;&gt;           weight=1.0</span>
<span class="sd">    &gt;&gt;&gt;           )</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>

    <span class="c1"># create instance of loss class</span>
    <span class="n">loss_instance</span> <span class="o">=</span> <span class="n">loss</span>

    <span class="n">target_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
        <span class="n">target_method</span><span class="o">=</span><span class="n">target_method</span><span class="p">,</span>
        <span class="n">loss</span><span class="o">=</span><span class="n">loss_instance</span><span class="p">,</span>
        <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">target_dict</span></div>



<div class="viewcode-block" id="Expert">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Expert">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Expert</span><span class="p">:</span>
<div class="viewcode-block" id="Expert.data">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Expert.data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dat</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide elicited-expert data for learning prior distributions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dat : dict</span>
<span class="sd">            Elicited data from expert provided as dictionary. Data must be</span>
<span class="sd">            provided in a standardized format.</span>
<span class="sd">            Use :func:`elicit.utils.get_expert_datformat` to get correct data</span>
<span class="sd">            format for your method specification.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        expert_data : dict</span>
<span class="sd">            Expert-elicited information used for learning prior distributions.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; expert_dat = {</span>
<span class="sd">        &gt;&gt;&gt;     &quot;quantiles_y_X0&quot;: [-12.55, -0.57, 3.29, 7.14, 19.15],</span>
<span class="sd">        &gt;&gt;&gt;     &quot;quantiles_y_X1&quot;: [-11.18, 1.45, 5.06, 8.83, 20.42],</span>
<span class="sd">        &gt;&gt;&gt;     &quot;quantiles_y_X2&quot;: [-9.28, 3.09, 6.83, 10.55, 23.29]</span>
<span class="sd">        &gt;&gt;&gt; }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Note: check for correct expert data format is done in Elicit class</span>
        <span class="n">dat_prep</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">key</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="mi">0</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dat</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat_prep</span><span class="p">)</span></div>


<div class="viewcode-block" id="Expert.simulator">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Expert.simulator">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">simulator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ground_truth</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10_000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate data from an oracle by defining a ground truth (true prior</span>
<span class="sd">        distribution(s)).</span>
<span class="sd">        See `Explanation: Simulating from an oracle (TODO) &lt;url&gt;`_ for</span>
<span class="sd">        further details.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ground_truth : dict</span>
<span class="sd">            True prior distribution(s). *Keys* refer to parameter names and</span>
<span class="sd">            *values* to prior distributions implemented as</span>
<span class="sd">            `tfp.distributions &lt;https://www.tensorflow.org/probability/api_docs/python/tfp/distributions&gt;`_</span>
<span class="sd">            object with predetermined hyperparameter values.</span>
<span class="sd">            You can specify a prior distribution for each model parameter or</span>
<span class="sd">            a joint prior for all model parameters at once or any approach in</span>
<span class="sd">            between. Only requirement is that the dimensionality of all priors</span>
<span class="sd">            in ground truth match with the number of model parameters.</span>
<span class="sd">            Order of priors in ground truth must match order of</span>
<span class="sd">            :func:`elicit.elicit.Elicit` argument ``parameters``.</span>
<span class="sd">        num_samples : int</span>
<span class="sd">            Number of draws from the prior distribution.</span>
<span class="sd">            It is recommended to use a high value to min. sampling variation.</span>
<span class="sd">            The default is ``10_000``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        expert_data : dict</span>
<span class="sd">            Settings of oracle for simulating from ground truth. True elicited</span>
<span class="sd">            statistics are used as `expert-data` in loss function.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; el.expert.simulator(</span>
<span class="sd">        &gt;&gt;&gt;     ground_truth = {</span>
<span class="sd">        &gt;&gt;&gt;         &quot;beta0&quot;: tfd.Normal(loc=5, scale=1),</span>
<span class="sd">        &gt;&gt;&gt;         &quot;beta1&quot;: tfd.Normal(loc=2, scale=1),</span>
<span class="sd">        &gt;&gt;&gt;         &quot;sigma&quot;: tfd.HalfNormal(scale=10.0),</span>
<span class="sd">        &gt;&gt;&gt;     },</span>
<span class="sd">        &gt;&gt;&gt;     num_samples = 10_000</span>
<span class="sd">        &gt;&gt;&gt; )</span>

<span class="sd">        &gt;&gt;&gt; el.expert.simulator(</span>
<span class="sd">        &gt;&gt;&gt;     ground_truth = {</span>
<span class="sd">        &gt;&gt;&gt;         &quot;betas&quot;: tfd.MultivariateNormalDiag([5.,2.], [1.,1.]),</span>
<span class="sd">        &gt;&gt;&gt;         &quot;sigma&quot;: tfd.HalfNormal(scale=10.0),</span>
<span class="sd">        &gt;&gt;&gt;     },</span>
<span class="sd">        &gt;&gt;&gt;     num_samples = 10_000</span>
<span class="sd">        &gt;&gt;&gt; )</span>

<span class="sd">        &gt;&gt;&gt; el.expert.simulator(</span>
<span class="sd">        &gt;&gt;&gt;     ground_truth = {</span>
<span class="sd">        &gt;&gt;&gt;         &quot;thetas&quot;: tfd.MultivariateNormalDiag([5.,2.,1.],</span>
<span class="sd">        &gt;&gt;&gt;                                              [1.,1.,1.]),</span>
<span class="sd">        &gt;&gt;&gt;     },</span>
<span class="sd">        &gt;&gt;&gt;     num_samples = 10_000</span>
<span class="sd">        &gt;&gt;&gt; )</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
        <span class="c1"># Note: check whether dimensionality of ground truth and number of</span>
        <span class="c1"># model parameters is identical is done in Elicit class</span>

        <span class="n">expert_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">ground_truth</span><span class="o">=</span><span class="n">ground_truth</span><span class="p">,</span>
                           <span class="n">num_samples</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">num_samples</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">expert_data</span></div>
</div>



<span class="c1"># create an instantiation of Expert class</span>
<span class="n">expert</span> <span class="o">=</span> <span class="n">Expert</span><span class="p">()</span>


<div class="viewcode-block" id="optimizer">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.optimizer">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">optimizer</span><span class="p">(</span><span class="n">optimizer</span><span class="p">:</span> <span class="nb">callable</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specification of optimizer and its settings for SGD.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    optimizer : callable, `tf.keras.optimizers &lt;https://www.tensorflow.org/api_docs/python/tf/keras/optimizers&gt;`_ object.</span>
<span class="sd">        Optimizer used for SGD implemented.</span>
<span class="sd">        Must be an object implemented in `tf.keras.optimizers &lt;https://www.tensorflow.org/api_docs/python/tf/keras/optimizers&gt;`_ object.</span>
<span class="sd">        The default is ``tf.keras.optimizers.Adam``.</span>
<span class="sd">    **kwargs : keyword arguments, optional</span>
<span class="sd">        Additional keyword arguments expected by **optimizer**.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    optimizer_dict : dict</span>
<span class="sd">        Dictionary specifying the SGD optimizer and its additional settings.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        ``optimizer`` is not a tf.keras.optimizers object</span>
<span class="sd">    ValueError</span>
<span class="sd">        ``optimizer`` could not be found in tf.keras.optimizers</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; optimizer=el.optimizer(</span>
<span class="sd">    &gt;&gt;&gt;     optimizer=tf.keras.optimizers.Adam,</span>
<span class="sd">    &gt;&gt;&gt;     learning_rate=0.1,</span>
<span class="sd">    &gt;&gt;&gt;     clipnorm=1.0</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>

    <span class="c1"># check whether optimizer is a tf.keras.optimizers object</span>
    <span class="n">opt_module</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">optimizer</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">opt_module</span> <span class="o">!=</span> <span class="s2">&quot;keras.src.optimizers&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;[section: optimizer] The &#39;optimizer&#39; must be a&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; tf.keras.optimizers object.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># check whether the optimizer object can be found in tf.keras.optimizers</span>
    <span class="n">opt_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">optimizer</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">opt_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;[section: optimizer] The argument &#39;optimizer&#39; has to be a&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; tf.keras.optimizers object.&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; Couldn&#39;t find </span><span class="si">{</span><span class="n">opt_name</span><span class="si">}</span><span class="s2"> in list of tf.keras.optimizers.&quot;</span>
        <span class="p">)</span>

    <span class="n">optimizer_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">optimizer_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">optimizer_dict</span></div>



<div class="viewcode-block" id="initializer">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.initializer">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">initializer</span><span class="p">(</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="ow">or</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">distribution</span><span class="p">:</span> <span class="nb">callable</span> <span class="ow">or</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">loss_quantile</span><span class="p">:</span> <span class="nb">float</span> <span class="ow">or</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="ow">or</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hyperparams</span><span class="p">:</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Only necessary for method ``parametric_prior``:</span>
<span class="sd">    Initialization of hyperparameter values. Two approaches are currently</span>
<span class="sd">    possible:</span>

<span class="sd">        1. Specify specific initial values for each hyperparameter.</span>
<span class="sd">        2. Use one of the implemented sampling approaches to draw initial</span>
<span class="sd">           values from one of the provided initialization distributions</span>

<span class="sd">    In (2) initial values for each hyperparameter are drawn from a uniform</span>
<span class="sd">    distribution ranging from ``mean-radius`` to ``mean+radius``.</span>
<span class="sd">    Further details on the implemented initialization method can be found in</span>
<span class="sd">    `Explanation: Initialization method &lt;url&gt;`_.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    method : string or None</span>
<span class="sd">        Name of initialization method. Currently supported are &quot;random&quot;, &quot;lhs&quot;,</span>
<span class="sd">        and &quot;sobol&quot;. The default value is ``None``.</span>
<span class="sd">    distribution : callable or None</span>
<span class="sd">        Specification of initialization distribution.</span>
<span class="sd">        Currently implemented methods: :func:`elicit.initialization.uniform`</span>
<span class="sd">        The default value is ``None``.</span>
<span class="sd">    loss_quantile : float or None,</span>
<span class="sd">        Quantile indicating which loss value should be used for selecting the</span>
<span class="sd">        initial hyperparameters.Specified as probability value between 0-1.</span>
<span class="sd">        The default value is ``None``.</span>
<span class="sd">    iterations : int or None</span>
<span class="sd">        Number of samples drawn from the initialization distribution.</span>
<span class="sd">        The default value is ``None``.</span>
<span class="sd">    hyperparams : dict or None</span>
<span class="sd">        Dictionary with specific initial values per hyperparameter. </span>
<span class="sd">        **Note:** Initial values are considered to be on the *unconstrained</span>
<span class="sd">        scale*. Use  the ``forward`` method of :func:`elicit.utils.LowerBound`,</span>
<span class="sd">        :func:`elicit.utils.UpperBound` and :func:`elicit.utils.DoubleBound`</span>
<span class="sd">        for transforming a constrained hyperparameter into an unconstrained one.</span>
<span class="sd">        In hyperparams dictionary, *keys* refer to hyperparameter names,</span>
<span class="sd">        as specified in :func:`hyper` and *values* to the respective initial</span>
<span class="sd">        values. The default value is ``None``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    init_dict : dict</span>
<span class="sd">        Dictionary specifying the initialization method.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        ``method`` can only take the values &quot;random&quot;, &quot;sobol&quot;, or &quot;lhs&quot;</span>

<span class="sd">        ``loss_quantile`` must be a probability ranging between 0 and 1.</span>

<span class="sd">        Either ``method`` or ``hyperparams`` has to be specified.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; el.initializer(</span>
<span class="sd">    &gt;&gt;&gt;     method=&quot;lhs&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     loss_quantile=0,</span>
<span class="sd">    &gt;&gt;&gt;     iterations=32,</span>
<span class="sd">    &gt;&gt;&gt;     distribution=el.initialization.uniform(</span>
<span class="sd">    &gt;&gt;&gt;         radius=1,</span>
<span class="sd">    &gt;&gt;&gt;         mean=0</span>
<span class="sd">    &gt;&gt;&gt;         )</span>
<span class="sd">    &gt;&gt;&gt;     )</span>

<span class="sd">    &gt;&gt;&gt; el.initializer(</span>
<span class="sd">    &gt;&gt;&gt;     hyperparams = dict(</span>
<span class="sd">    &gt;&gt;&gt;         mu0=0., sigma0=el.utils.LowerBound(lower=0.).forward(0.3),</span>
<span class="sd">    &gt;&gt;&gt;         mu1=1., sigma1=el.utils.LowerBound(lower=0.).forward(0.5),</span>
<span class="sd">    &gt;&gt;&gt;         sigma2=el.utils.LowerBound(lower=0.).forward(0.4)</span>
<span class="sd">    &gt;&gt;&gt;         )</span>
<span class="sd">    &gt;&gt;&gt;     )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check that method is implemented</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># compute percentage from probability</span>
        <span class="n">quantile_perc</span> <span class="o">=</span> <span class="n">loss_quantile</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="c1"># ensure that iterations is an integer</span>
        <span class="n">iterations</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">iterations</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;random&quot;</span><span class="p">,</span> <span class="s2">&quot;lhs&quot;</span><span class="p">,</span> <span class="s2">&quot;sobol&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;[section: initializer] Currently implemented initialization&quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; methods are &#39;random&#39;, &#39;sobol&#39;, and &#39;lhs&#39;, but got &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; as input.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># check that quantile is provided as probability</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">loss_quantile</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">loss_quantile</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;[section: initializer] &#39;loss_quantile&#39; must be a value between 0&quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; and 1. Found &#39;loss_quantile=</span><span class="si">{</span><span class="n">loss_quantile</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hyperparams</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;[section: initializer] Either &#39;method&#39; or &#39;hyperparams&#39; has&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; to be specified. Use method for sampling from an&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; initialization distribution and &#39;hyperparams&#39; for&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; specifying exact initial values per hyperparameter.&quot;</span><span class="p">)</span>

    <span class="n">init_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
        <span class="n">distribution</span><span class="o">=</span><span class="n">distribution</span><span class="p">,</span>
        <span class="n">loss_quantile</span><span class="o">=</span><span class="n">loss_quantile</span><span class="p">,</span>
        <span class="n">iterations</span><span class="o">=</span><span class="n">iterations</span><span class="p">,</span>
        <span class="n">hyperparams</span><span class="o">=</span><span class="n">hyperparams</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">init_dict</span></div>



<div class="viewcode-block" id="trainer">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.trainer">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">trainer</span><span class="p">(</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">B</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
    <span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specification of training settings for learning the prior distribution(s).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    method : str</span>
<span class="sd">        Method for learning the prior distribution. Available is either</span>
<span class="sd">        ``parametric_prior`` for learning independent parametric priors</span>
<span class="sd">        or ``deep_prior`` for learning a joint non-parameteric prior.</span>
<span class="sd">    seed : int</span>
<span class="sd">        seed used for learning.</span>
<span class="sd">    epochs : int</span>
<span class="sd">        number of iterations until training is stopped.</span>
<span class="sd">    B : int, optional</span>
<span class="sd">        batch size. The default is 128.</span>
<span class="sd">    num_samples : int, optional</span>
<span class="sd">        number of samples from the prior(s). The default is 200.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    train_dict : dict</span>
<span class="sd">        dictionary specifying the training settings for learning the prior</span>
<span class="sd">        distribution(s).</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        ``method`` can only take the value &quot;parametric_prior&quot; or &quot;deep_prior&quot;</span>

<span class="sd">        ``epochs`` can only take positive integers. Minimum number of epochs</span>
<span class="sd">        is 1.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; el.trainer(</span>
<span class="sd">    &gt;&gt;&gt;     method=&quot;parametric_prior&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     seed=0,</span>
<span class="sd">    &gt;&gt;&gt;     epochs=400,</span>
<span class="sd">    &gt;&gt;&gt;     B=128,</span>
<span class="sd">    &gt;&gt;&gt;     num_samples=200</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
    <span class="c1"># check that epochs are positive numbers</span>
    <span class="k">if</span> <span class="n">epochs</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;[section: trainer] The number of epochs has to be at least 1.&quot;</span><span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot; Got </span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s2"> epochs&quot;</span>
            <span class="p">)</span>
    <span class="c1"># check that method is implemented</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;parametric_prior&quot;</span><span class="p">,</span> <span class="s2">&quot;deep_prior&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;[section: trainer] Currently only the methods &#39;deep_prior&#39; and&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; &#39;parametric prior&#39; are implemented but got &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="n">train_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">seed</span><span class="p">),</span>
        <span class="n">B</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">B</span><span class="p">),</span>
        <span class="n">num_samples</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">num_samples</span><span class="p">),</span>
        <span class="n">epochs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">epochs</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">train_dict</span></div>



<div class="viewcode-block" id="Elicit">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Elicit">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Elicit</span><span class="p">:</span>
<div class="viewcode-block" id="Elicit.__init__">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Elicit.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">targets</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">expert</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
        <span class="n">trainer</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
        <span class="n">network</span><span class="p">:</span> <span class="nb">callable</span> <span class="ow">or</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">initializer</span><span class="p">:</span> <span class="nb">callable</span> <span class="ow">or</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : callable</span>
<span class="sd">            specification of generative model using :func:`model`.</span>
<span class="sd">        parameters : list</span>
<span class="sd">            list of model parameters specified with :func:`parameter`.</span>
<span class="sd">        targets : list</span>
<span class="sd">            list of target quantities specified with :func:`target`.</span>
<span class="sd">        expert : callable</span>
<span class="sd">            provide input data from expert or simulate data from oracle with</span>
<span class="sd">            either the ``data`` or ``simulator`` method of the</span>
<span class="sd">            :mod:`elicit.elicit.Expert` module.</span>
<span class="sd">        trainer : callable</span>
<span class="sd">            specification of training settings and meta-information for</span>
<span class="sd">            workflow using :func:`trainer`</span>
<span class="sd">        optimizer : callable</span>
<span class="sd">            specification of SGD optimizer and its settings using</span>
<span class="sd">            :func:`optimizer`.</span>
<span class="sd">        network : callable or None</span>
<span class="sd">            specification of neural network using a method implemented in</span>
<span class="sd">            :mod:`elicit.networks`.</span>
<span class="sd">            Only required for ``deep_prior`` method. For ``parametric_prior``</span>
<span class="sd">            use ``None``. Default value is ``None``.</span>
<span class="sd">        initializer : callable</span>
<span class="sd">            specification of initialization settings using</span>
<span class="sd">            :func:`initializer`. Only required for ``parametric_prior`` method.</span>
<span class="sd">            Otherwise the argument should be ``None``. Default value is</span>
<span class="sd">            ``None.``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        eliobj : class instance</span>
<span class="sd">            specification of all settings to run the elicitation workflow and</span>
<span class="sd">            fit the eliobj.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        AssertionError</span>
<span class="sd">            ``expert`` data are not in the required format. Correct specification of</span>
<span class="sd">            keys can be checked using el.utils.get_expert_datformat</span>

<span class="sd">            Dimensionality of ``ground_truth`` for simulating expert data, must be</span>
<span class="sd">            the same as the number of model parameters.</span>

<span class="sd">        ValueError</span>
<span class="sd">            if ``method=&quot;deep_prior&quot;``, ``network`` can&#39;t be None and ``initialization``</span>
<span class="sd">            should be None.</span>

<span class="sd">            if ``method=&quot;deep_prior&quot;``, ``num_params`` as specified in the ``network_specs``</span>
<span class="sd">            argument (section: network) does not match the number of parameters</span>
<span class="sd">            specified in the parameters section.</span>

<span class="sd">            if ``method=&quot;parametric_prior&quot;``, ``network`` should be None and</span>
<span class="sd">            ``initialization`` can&#39;t be None.</span>

<span class="sd">            if ``method =&quot;parametric_prior&quot; and multiple hyperparameter have</span>
<span class="sd">            the same name but are not shared by setting ``shared=True``.&quot;</span>

<span class="sd">            if ``hyperparams`` is specified in section ``initializer`` and a</span>
<span class="sd">            hyperparameter name (key in hyperparams dict) does not match any</span>
<span class="sd">            hyperparameter name specified in :func:`hyper`.</span>

<span class="sd">        NotImplementedError</span>
<span class="sd">            [network] Currently only the standard normal distribution is</span>
<span class="sd">            implemented as base distribution. See `GitHub issue #35 &lt;https://github.com/florence-bockting/prior_elicitation/issues/35&gt;`_.</span>

<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
        <span class="c1"># check expert data</span>
        <span class="n">expected_dict</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_expert_datformat</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">expert</span><span class="p">[</span><span class="s2">&quot;ground_truth&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># input expert data: ensure data has expected format</span>
            <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">expert</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">(</span><span class="n">expected_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;[section: expert] Provided expert data is not in the &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;correct format. Please use &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;el.utils.get_expert_datformat to check expected format.&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># oracle: ensure ground truth has same dim as number of model param</span>
            <span class="n">expected_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">]</span>
            <span class="n">num_params</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">expert</span><span class="p">[</span><span class="s2">&quot;ground_truth&quot;</span><span class="p">]:</span>
                <span class="n">num_params</span> <span class="o">+=</span> <span class="n">expert</span><span class="p">[</span><span class="s2">&quot;ground_truth&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected_params</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_params</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                    <span class="s2">&quot;[section: expert] Dimensionality of ground truth in&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot; &#39;expert&#39; is not the same  as number of model&quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; parameters.Got </span><span class="si">{</span><span class="n">num_params</span><span class="si">}</span><span class="s2">, expected&quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">expected_params</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
        <span class="c1"># check that network architecture is provided when method is deep prior</span>
        <span class="c1"># and initializer is none</span>
        <span class="k">if</span> <span class="n">trainer</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;deep_prior&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">network</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;[section network] If method is &#39;deep prior&#39;,&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot; the section &#39;network&#39; can&#39;t be None.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">initializer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;[section initializer] For method &#39;deep_prior&#39; the &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;&#39;initializer&#39; is not used and should be set to None.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;network_specs&quot;</span><span class="p">][</span><span class="s2">&quot;num_params&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;[section network] The number of model parameters as &quot;</span>
                    <span class="o">+</span><span class="s2">&quot;specified in the parameters section, must match the&quot;</span>
                    <span class="o">+</span><span class="s2">&quot; number of parameters specified in the network (see&quot;</span>
                    <span class="o">+</span><span class="s2">&quot; network_specs[&#39;num_params&#39;] argument).&quot;</span>
                    <span class="o">+</span><span class="sa">f</span><span class="s2">&quot; Expected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="si">}</span><span class="s2"> but got&quot;</span>
                    <span class="o">+</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">network</span><span class="p">[</span><span class="s1">&#39;network_specs&#39;</span><span class="p">][</span><span class="s1">&#39;num_params&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
        <span class="c1"># check that initializer is provided when method=parametric prior</span>
        <span class="c1"># and network is none</span>
        <span class="k">if</span> <span class="n">trainer</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;parametric_prior&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">initializer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;[section initializer] If method is &#39;parametric_prior&#39;,&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot; the section &#39;initializer&#39; can&#39;t be None.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">network</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;[section network] If method is &#39;parametric prior&#39;&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot; the &#39;network&#39; is not used and should be set to None.&quot;</span>
                <span class="p">)</span>
        <span class="c1"># check that hyperparameter names are not redundant</span>
        <span class="k">if</span> <span class="n">trainer</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;parametric_prior&quot;</span><span class="p">:</span>
            <span class="n">hyp_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">hyp_shared</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)):</span>
                <span class="n">hyp_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;hyperparams&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span>
                     <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;hyperparams&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
                <span class="n">hyp_shared</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;hyperparams&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;shared&quot;</span><span class="p">]</span> <span class="k">for</span>
                     <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;hyperparams&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
            <span class="c1"># flatten nested list</span>
            <span class="n">hyp_names_flat</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">hyp_names</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">hyp_shared_flat</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">hyp_shared</span><span class="p">,</span> <span class="p">[])</span>

            <span class="k">if</span> <span class="n">initializer</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">initializer</span><span class="p">[</span><span class="s2">&quot;hyperparams&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hyp_names_flat</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;[initializer] Hyperparameter name &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; doesn&#39;t&quot;</span><span class="o">+</span>
                            <span class="s2">&quot; match any name specified in the parameters &quot;</span><span class="o">+</span>
                            <span class="s2">&quot;section. Have you misspelled the name?&quot;</span><span class="p">)</span>

            <span class="n">seen</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">duplicate</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">share</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hyp_names_flat</span><span class="p">,</span> <span class="n">hyp_shared_flat</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                    <span class="n">seen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
                        <span class="n">share</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">duplicate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicate</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;[parameters] The following hyperparameter have the same&quot;</span>
                    <span class="o">+</span><span class="sa">f</span><span class="s2">&quot; name but are not shared: </span><span class="si">{</span><span class="n">duplicate</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="o">+</span><span class="s2">&quot; Have you forgot to set shared=True?&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">network</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">network</span><span class="p">[</span><span class="s2">&quot;base_distribution&quot;</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">!=</span> <span class="n">el</span><span class="o">.</span><span class="n">networks</span><span class="o">.</span><span class="n">BaseNormal</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;[network] Currently only the standard normal distribution&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot; is implemented as base distribution.&quot;</span>
                    <span class="o">+</span><span class="s2">&quot; See GitHub issue #35.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expert</span> <span class="o">=</span> <span class="n">expert</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span> <span class="o">=</span> <span class="n">trainer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initializer</span> <span class="o">=</span> <span class="n">initializer</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="c1"># set seed</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="Elicit.fit">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Elicit.fit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">save_history</span><span class="p">:</span> <span class="nb">callable</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">save_history</span><span class="p">(),</span>
            <span class="n">save_results</span><span class="p">:</span> <span class="nb">callable</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">save_results</span><span class="p">(),</span>
            <span class="n">parallel</span><span class="p">:</span> <span class="nb">callable</span> <span class="ow">or</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        method for fitting the eliobj and learn prior distributions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        overwrite : bool, optional</span>
<span class="sd">            If the eliobj was already fitted and the user wants to refit it,</span>
<span class="sd">            the user is asked whether they want to overwrite the previous</span>
<span class="sd">            fitting results. Setting ``overwrite=True`` allows the user to</span>
<span class="sd">            force overfitting without being prompted. The default is ``False``.</span>
<span class="sd">        save_history : callable, :func:`elicit.utils.save_history`</span>
<span class="sd">            Exclude or include sub-results in the final result file.</span>
<span class="sd">            In the ``history`` object are all results that are saved across epochs.</span>
<span class="sd">            For usage information see</span>
<span class="sd">            `How-To: Save and load the eliobj &lt;https://florence-bockting.github.io/prior_elicitation/howto/saving_loading.html&gt;`_</span>
<span class="sd">        save_results : callable, :func:`elicit.utils.save_results`</span>
<span class="sd">            Exclude or include sub-results in the final result file.</span>
<span class="sd">            In the ``results`` object are all results that are saved for the last</span>
<span class="sd">            epoch only. For usage information see</span>
<span class="sd">            `How-To: Save and load the eliobj &lt;https://florence-bockting.github.io/prior_elicitation/howto/saving_loading.html&gt;`_</span>
<span class="sd">        parallel : callable, :func:`elicit.utils.parallel`</span>
<span class="sd">            specify parallelization settings if multiple trainings should run</span>
<span class="sd">            in parallel.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; eliobj.fit()</span>

<span class="sd">        &gt;&gt;&gt; eliobj.fit(overwrite=True,</span>
<span class="sd">        &gt;&gt;&gt;            save_history=el.utils.save_history(</span>
<span class="sd">        &gt;&gt;&gt;                loss_component=False</span>
<span class="sd">        &gt;&gt;&gt;                )</span>
<span class="sd">        &gt;&gt;&gt;            )</span>

<span class="sd">        &gt;&gt;&gt; eliobj.fit(parallel=el.utils.parallel(runs=4)</span>

<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>

        <span class="c1"># set seed</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">])</span>

        <span class="c1"># check whether elicit object is already fitted</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">user_answ</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;eliobj is already fitted.&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; Do you want to fit it again and overwrite the results?&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; Press &#39;n&#39; to stop process and &#39;y&#39; to continue fitting.&quot;</span>
            <span class="p">)</span>

            <span class="k">while</span> <span class="n">user_answ</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]:</span>
                <span class="n">user_answ</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                    <span class="s2">&quot;Please press either &#39;y&#39; for fitting or &#39;n&#39;&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot; for abording the process.&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">user_answ</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Process aborded; eliobj is not re-fitted.&quot;</span><span class="p">)</span>

        <span class="c1"># run single time if no parallelization is required</span>
        <span class="k">if</span> <span class="n">parallel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">])</span>
            <span class="c1"># include seed information into results</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span>
            <span class="c1"># remove results that user wants to exclude from saving</span>
            <span class="n">results_prep</span><span class="p">,</span> <span class="n">history_prep</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_savings</span><span class="p">(</span>
                <span class="n">history</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">save_history</span><span class="p">,</span> <span class="n">save_results</span><span class="p">)</span>
            <span class="c1"># save results in list attribute</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_prep</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results_prep</span><span class="p">)</span>
        <span class="c1"># run multiple replications</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># create a list of seeds if not provided</span>
            <span class="k">if</span> <span class="n">parallel</span><span class="p">[</span><span class="s2">&quot;seeds&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># generate seeds</span>
                <span class="n">seeds</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> 
                       <span class="n">tfd</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">999999</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">parallel</span><span class="p">[</span><span class="s2">&quot;runs&quot;</span><span class="p">])]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">seeds</span> <span class="o">=</span> <span class="n">parallel</span><span class="p">[</span><span class="s2">&quot;seeds&quot;</span><span class="p">]</span>

            <span class="c1"># run training simultaneously for multiple seeds</span>
            <span class="p">(</span><span class="o">*</span><span class="n">res</span><span class="p">,)</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">Parallel</span><span class="p">(</span>
                <span class="n">n_jobs</span><span class="o">=</span><span class="n">parallel</span><span class="p">[</span><span class="s2">&quot;cores&quot;</span><span class="p">])(</span>
                    <span class="n">joblib</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow</span><span class="p">)(</span><span class="n">seed</span><span class="p">)</span> <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">seeds</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seeds</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">seed</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_savings</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">save_history</span><span class="p">,</span>
                    <span class="n">save_results</span><span class="p">)</span></div>


<div class="viewcode-block" id="Elicit.save">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Elicit.save">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="ow">or</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">file</span><span class="p">:</span> <span class="nb">str</span> <span class="ow">or</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        method for saving the eliobj on disk</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name: str or None</span>
<span class="sd">            file name used to store the eliobj. Saving is done</span>
<span class="sd">            according to the following rule: ``./{method}/{name}_{seed}.pkl``</span>
<span class="sd">            with &#39;method&#39; and &#39;seed&#39; being arguments of</span>
<span class="sd">            :func:`elicit.elicit.trainer`.</span>
<span class="sd">        file : str or None</span>
<span class="sd">            user-specific path for saving the eliobj. If file is specified</span>
<span class="sd">            **name** must be ``None``. The default value is ``None``.</span>
<span class="sd">        overwrite : bool, optional</span>
<span class="sd">            If already a fitted object exists in the same path, the user is</span>
<span class="sd">            asked whether the eliobj should be refitted and the results</span>
<span class="sd">            overwritten. With the ``overwrite`` argument you can silent this</span>
<span class="sd">            behavior. In this case the results are automatically overwritten</span>
<span class="sd">            without prompting the user. The default is ``False``.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    AssertionError</span>
<span class="sd">        ``name`` and ``file`` can&#39;t be specified simultaneously.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; eliobj.save(name=&quot;toymodel&quot;)</span>

<span class="sd">        &gt;&gt;&gt; eliobj.save(file=&quot;res/toymodel&quot;, overwrite=True)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check that either name or file is specified</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span>  <span class="ne">AssertionError</span><span class="p">(</span>
            <span class="s2">&quot;Name and file cannot be both None or both specified.&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; Either one has to be None.&quot;</span>
        <span class="p">)</span>

        <span class="c1"># add a saving path</span>
        <span class="k">return</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span></div>


<div class="viewcode-block" id="Elicit.update">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Elicit.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        method for updating the attributes of the Elicit class. Updating</span>
<span class="sd">        an eliobj leads to an automatic reset of results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : any</span>
<span class="sd">            keyword argument used for updating an attribute of Elicit class.</span>
<span class="sd">            Key must correspond to one attribute of the class and value refers</span>
<span class="sd">            to the updated value.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            key of provided keyword argument is not an eliobj attribute. Please</span>
<span class="sd">            check dir(eliobj).</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; eliobj.update(parameter = updated_parameter_dict)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check that arguments exist as eliobj attributes</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;parameters&quot;</span><span class="p">,</span>
                <span class="s2">&quot;targets&quot;</span><span class="p">,</span>
                <span class="s2">&quot;expert&quot;</span><span class="p">,</span>
                <span class="s2">&quot;trainer&quot;</span><span class="p">,</span>
                <span class="s2">&quot;optimizer&quot;</span><span class="p">,</span>
                <span class="s2">&quot;network&quot;</span><span class="p">,</span>
                <span class="s2">&quot;initializer&quot;</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is not an eliobj attribute.&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot; Use dir() to check for attributes.&quot;</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="c1"># reset results</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="c1"># inform user about reset of results</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INFO: Results have been reset.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Elicit.workflow">
<a class="viewcode-back" href="../../api/elicit.elicit.html#elicit.elicit.Elicit.workflow">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        helper function that builds the main workflow of the prior elicitation</span>
<span class="sd">        method: get expert data, initialize method, run optimization.</span>
<span class="sd">        Results are returned for further post-processing.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        seed : int</span>
<span class="sd">            seed information used for reproducing results.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results, history = Tuple(list, list)</span>
<span class="sd">            results of the optimization process.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="p">[</span><span class="s2">&quot;seed_chain&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">seed</span>
        <span class="c1"># get expert data</span>
        <span class="n">expert_elicits</span><span class="p">,</span> <span class="n">expert_prior</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_expert_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expert</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># initialization of hyperparameter</span>
        <span class="p">(</span><span class="n">init_prior_model</span><span class="p">,</span> <span class="n">loss_list</span><span class="p">,</span> <span class="n">init_prior</span><span class="p">,</span> <span class="n">init_matrix</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">el</span><span class="o">.</span><span class="n">initialization</span><span class="o">.</span><span class="n">init_prior</span><span class="p">(</span>
                <span class="n">expert_elicits</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initializer</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expert</span><span class="p">,</span>
                <span class="n">seed</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># run dag with optimal set of initial values</span>
        <span class="c1"># save results in corresp. attributes</span>
        <span class="n">history</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">optimization</span><span class="o">.</span><span class="n">sgd_training</span><span class="p">(</span>
            <span class="n">expert_elicits</span><span class="p">,</span>
            <span class="n">init_prior_model</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
            <span class="n">seed</span>
        <span class="p">)</span>
        <span class="c1"># add some additional results</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;expert_elicited_statistics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expert_elicits</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expert</span><span class="p">[</span><span class="s2">&quot;ground_truth&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;expert_prior_samples&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expert_prior</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;parametric_prior&quot;</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;init_loss_list&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loss_list</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;init_prior&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_prior</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;init_matrix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_matrix</span>

        <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">history</span></div>
</div>

</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Florence Bockting
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, Florence Bockting.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>